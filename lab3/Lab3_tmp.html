<!DOCTYPE html>
<html>
<head>
<title>Lab3.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="entity-framework">Entity Framework</h1>
<p>ćwiczenie 3</p>
<hr>
<p><strong>Imiona i nazwiska autorów: Stas Kochevenko &amp; Wiktor Dybalski</strong></p>
<hr>
<h1 id="wproradzenie">Wproradzenie</h1>
<p>Zostały dodane podstawowe klasy Product, ProdContext oraz Program, baza danych MyProductDatabase.</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/1.png" alt=""></p>
<!-- <div style="page-break-after: always;"></div> -->
<p>Kod:</p>
<ul>
<li>Product.cs</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">using</span> System.Runtime.Intrinsics.X86;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Product</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> ProductID { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> String? ProductName { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> UnitsInStock { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
}
</div></code></pre>
<ul>
<li>ProdContext.cs</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">using</span> Microsoft.EntityFrameworkCore;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ProdContext</span> : <span class="hljs-title">DbContext</span>
{
    <span class="hljs-keyword">public</span> DbSet&lt;Product&gt; Products { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnConfiguring</span>(<span class="hljs-params">DbContextOptionsBuilder optionsBuilder</span>)</span>
    {
        <span class="hljs-keyword">base</span>.OnConfiguring(optionsBuilder);
        optionsBuilder.UseSqlite(<span class="hljs-string">"Datasource=MyProductDatabase"</span>);
    }
}
</div></code></pre>
<ul>
<li>Program.cs</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Linq;

Console.WriteLine(<span class="hljs-string">"Podaj nazwę produktu: "</span>);
String? prodName = Console.ReadLine();

ProdContext productContext = <span class="hljs-keyword">new</span> ProdContext();

Product product = <span class="hljs-keyword">new</span> Product { ProductName = prodName, UnitsInStock = <span class="hljs-number">24</span>, Supplier = supplier };
productContext.Products.Add(product);
productContext.SaveChanges();

<span class="hljs-keyword">var</span> query = <span class="hljs-keyword">from</span> prod <span class="hljs-keyword">in</span> productContext.Products
            <span class="hljs-keyword">select</span> <span class="hljs-keyword">new</span> { prod.ProductID, prod.ProductName };

<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> pName <span class="hljs-keyword">in</span> query)
{
    Console.WriteLine(pName);
}
</div></code></pre>
<hr>
<h1 id="zadanie-a---wprowadzenie-poj%C4%99cia-dostawcy">Zadanie a - wprowadzenie pojęcia Dostawcy</h1>
<p>Została dodana klasa Supplier oraz zaktualizowana odpowiednio klasa Product, żeby mieć połączenie z klasą Supplier.</p>
<p>Schemat zmienionej bazy danych, wygenerowany przez DataGrip:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/2.png" alt=""></p>
<p>Testowanie dodania nowego dostawcy i ustawienia dostawcy poprzednio wprowadzonego produktu na dodanego dostawcę. Tabela Products przed wywołaniem metody dodającej:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/4.png" alt=""></p>
<p>Wynik działania programu w postaci konsolowych komunikatów:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/3.png" alt=""></p>
<p>Sprawdżmy trwałość zmian za pomocą DataGrip:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/5.png" alt=""></p>
<p>Testowanie ustawienia dostawcy dla poprzednio wprowadzonego produktu. Wynik działania programu w postaci konsolowych komunikatów:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/6.png" alt=""></p>
<p>Sprawdżmy trwałość zmian za pomocą DataGrip:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/7.png" alt=""></p>
<p>Kod:</p>
<ul>
<li>Product.cs</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">using</span> System.Runtime.Intrinsics.X86;

<span class="hljs-keyword">using</span> System.Runtime.Intrinsics.X86;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Product</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> ProductID { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> String? ProductName { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> UnitsInStock { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> Supplier? supplier { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">null</span>;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">string</span> <span class="hljs-title">ToString</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">string</span> supName = <span class="hljs-string">"undefined"</span>;
        <span class="hljs-keyword">if</span> (supplier != <span class="hljs-literal">null</span>)
        {
            supName = supplier.CompanyName;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">$"<span class="hljs-subst">{ProductName}</span>: <span class="hljs-subst">{UnitsInStock}</span> szt. Dostawca: <span class="hljs-subst">{supName}</span>"</span>;
    }
}
</div></code></pre>
<ul>
<li>Supplier.cs</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Supplier</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> SupplierID { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> CompanyName { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Street { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> City { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">string</span> <span class="hljs-title">ToString</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">return</span> CompanyName;
    }
}
</div></code></pre>
<ul>
<li>ProdContext.cs</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">using</span> Microsoft.EntityFrameworkCore;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ProdContext</span> : <span class="hljs-title">DbContext</span>
{
    <span class="hljs-keyword">public</span> DbSet&lt;Product&gt; Products { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> DbSet&lt;Supplier&gt; Suppliers { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnConfiguring</span>(<span class="hljs-params">DbContextOptionsBuilder optionsBuilder</span>)</span>
    {
        <span class="hljs-keyword">base</span>.OnConfiguring(optionsBuilder);
        optionsBuilder.UseSqlite(<span class="hljs-string">"Datasource=MyProductDatabase"</span>);
    }
}
</div></code></pre>
<ul>
<li>Program.cs</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Product <span class="hljs-title">createNewProduct</span>(<span class="hljs-params"></span>)</span>
    {
        Console.Write(<span class="hljs-string">"Podaj nazwę nowego produktu: "</span>);
        <span class="hljs-keyword">string</span> prodName = Console.ReadLine();
        Console.Write(<span class="hljs-string">"Podaj ilość jednostek danego produktu dostępnych w sklepie: "</span>);
        <span class="hljs-keyword">int</span> quantity = Int32.Parse(Console.ReadLine());

        Product product = <span class="hljs-keyword">new</span> Product { ProductName = prodName, UnitsInStock = quantity };
        Console.Write(<span class="hljs-string">$"Został utworzony produkt: <span class="hljs-subst">{product}</span>;"</span>);

        <span class="hljs-keyword">return</span> product;
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Product <span class="hljs-title">findProduct</span>(<span class="hljs-params">ProdContext productContext</span>)</span>
    {
        Console.Write(<span class="hljs-string">"Podaj ID produktu do wyszukiwania: "</span>);
        <span class="hljs-keyword">int</span> prodID = Int32.Parse(Console.ReadLine());

        <span class="hljs-keyword">var</span> query = <span class="hljs-keyword">from</span> prod <span class="hljs-keyword">in</span> productContext.Products
                    <span class="hljs-keyword">where</span> prod.ProductID == prodID
                    <span class="hljs-keyword">select</span> prod;

        <span class="hljs-keyword">return</span> query.FirstOrDefault();
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">showAllProducts</span>(<span class="hljs-params">ProdContext productContext</span>)</span>
    {
        Console.WriteLine(<span class="hljs-string">"Lista produktów: "</span>);
        <span class="hljs-keyword">foreach</span> (Product product <span class="hljs-keyword">in</span> productContext.Products)
        {
            Console.WriteLine(<span class="hljs-string">$"<span class="hljs-subst">{product.ProductID}</span> | <span class="hljs-subst">{product}</span>"</span>);
        }

    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Supplier <span class="hljs-title">createNewSupplier</span>(<span class="hljs-params"></span>)</span>
    {
        Console.Write(<span class="hljs-string">"Podaj nazwę nowego dostawcy: "</span>);
        <span class="hljs-keyword">string</span> companyName = Console.ReadLine();
        Console.Write(<span class="hljs-string">"Podaj nazwę miasta: "</span>);
        <span class="hljs-keyword">string</span> city = Console.ReadLine();
        Console.Write(<span class="hljs-string">"Podaj nazwę ulicy: "</span>);
        <span class="hljs-keyword">string</span> street = Console.ReadLine();

        Supplier supplier = <span class="hljs-keyword">new</span> Supplier { CompanyName = companyName, City = city, Street = street };
        Console.Write(<span class="hljs-string">$"Został utworzony dostawca: <span class="hljs-subst">{supplier}</span>.\n"</span>);

        <span class="hljs-keyword">return</span> supplier;
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Supplier <span class="hljs-title">findSupplier</span>(<span class="hljs-params">ProdContext productContext</span>)</span>
    {
        Console.Write(<span class="hljs-string">"Podaj ID dostawcy do wyszukiwania: "</span>);
        <span class="hljs-keyword">int</span> supplierID = Int32.Parse(Console.ReadLine());

        <span class="hljs-keyword">var</span> query = <span class="hljs-keyword">from</span> supplier <span class="hljs-keyword">in</span> productContext.Suppliers
                    <span class="hljs-keyword">where</span> supplier.SupplierID == supplierID
                    <span class="hljs-keyword">select</span> supplier;

        <span class="hljs-keyword">return</span> query.FirstOrDefault();
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">showAllSuppliers</span>(<span class="hljs-params">ProdContext productContext</span>)</span>
    {
        Console.WriteLine(<span class="hljs-string">"Lista dostawców: "</span>);
        <span class="hljs-keyword">foreach</span> (Supplier supplier <span class="hljs-keyword">in</span> productContext.Suppliers)
        {
            Console.WriteLine(<span class="hljs-string">$"<span class="hljs-subst">{supplier.SupplierID}</span> | <span class="hljs-subst">{supplier}</span>"</span>);
        }

    }

    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"></span>)</span>
    {
        ProdContext productContext = <span class="hljs-keyword">new</span> ProdContext();

        Supplier supplier = <span class="hljs-literal">null</span>;

        Console.WriteLine(<span class="hljs-string">"Dodać nowego dostawcę? (Tak/Nie)"</span>);
        <span class="hljs-keyword">string</span> choice = Console.ReadLine();
        <span class="hljs-keyword">bool</span> correctAnswer = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">do</span>
        {
            <span class="hljs-keyword">switch</span> (choice)
            {
                <span class="hljs-keyword">case</span> <span class="hljs-string">"Tak"</span>:
                    supplier = createNewSupplier();
                    productContext.Suppliers.Add(supplier);
                    correctAnswer = <span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"Nie"</span>:
                    showAllSuppliers(productContext);
                    supplier = findSupplier(productContext);
                    correctAnswer = <span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">break</span>;
            }
        } <span class="hljs-keyword">while</span> (!correctAnswer);

        productContext.SaveChanges();

        Console.WriteLine(<span class="hljs-string">""</span>);

        Product product = findProduct(productContext);

        Console.WriteLine(<span class="hljs-string">""</span>);

        Console.WriteLine(<span class="hljs-string">"Zmienić dostawcę dla produktu na podanego wyżej? (Tak/Nie)"</span>);
        choice = Console.ReadLine();
        correctAnswer = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">do</span>
        {
            <span class="hljs-keyword">switch</span> (choice)
            {
                <span class="hljs-keyword">case</span> <span class="hljs-string">"Tak"</span>:
                    product.supplier = supplier;
                    Console.Write(<span class="hljs-string">$"\nDla productu: <span class="hljs-subst">{product.ProductName}</span> zmieniono dostawcę na: <span class="hljs-subst">{supplier.CompanyName}</span>.\n"</span>);
                    productContext.SaveChanges();
                    correctAnswer = <span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"Nie"</span>:
                    correctAnswer = <span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">break</span>;
            }
        } <span class="hljs-keyword">while</span> (!correctAnswer);

        showAllProducts(productContext);

        showAllSuppliers(productContext);
    }
}
</div></code></pre>
<hr>
<h1 id="zadanie-b---odwr%C3%B3cenie-relacji-supplier---product">Zadanie b - odwrócenie relacji Supplier -&gt; Product</h1>
<ul>
<li>Z klasy &quot;Product&quot; został usunięty atrybut &quot;Supplier&quot; zgodnie ze schematem.</li>
<li>W klasie &quot;Supplier&quot; dodano kolekcję produktów, dostarczanych przez danego dostawcę.</li>
<li>W kodzie głównego programu został dodany fragment kodu odpowiedzialny za dodanie nowych produktów. W poruwnywniu do zadania 1, jedyną zmianą było ustawienie produktu do dostawcy, zamiast ustawienia dostawcy do produktu. Niżej będzie podany fragment kodu, który uległ zmianie.</li>
<li>Klasa ProdContext pozostała bez zmian.</li>
</ul>
<p>Schemat zmienionej bazy danych, wygenerowany przez DataGrip:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/2.png" alt=""></p>
<p>Jak widać, pomimo odwrócenia relacji, schemat bazy danych się nie zmienił. Entity Framework dokonał optymalizacji, dzięki czemu uniknęliśmy powielania danych w tabeli Suppliers (ponieważ nie możemy trzymać listy w polu). Oprócz tego takie podejście miało by gorsze konsekwencje: każdy rekord miałby nowy SupplierID, mimo że byłby to ten sam dostawca, jedynie mający przypisany inny ProductID. W takiej sytuacji nie bylibyśmy w stanie odróżnic dostawców.</p>
<p>Testowanie dodania nowych produktów i ustawienia ich dostawcy na nowo stworzonego. Tabela Products przed wywołaniem metody dodającej:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/7.png" alt=""></p>
<p>Wynik działania programu w postaci konsolowych komunikatów:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/8.png" alt=""></p>
<p>Sprawdżmy trwałość zmian za pomocą DataGrip. Tabela Product po dodaniu produktów:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/9.png" alt=""></p>
<p>Tabela Product po wprowadzeniu zmiany dostawcy:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/10.png" alt=""></p>
<p>Kod:</p>
<ul>
<li>Product.cs</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">using</span> System.Runtime.Intrinsics.X86;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Product</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> ProductID { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> String? ProductName { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> UnitsInStock { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">string</span> <span class="hljs-title">ToString</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">return</span> <span class="hljs-string">$"<span class="hljs-subst">{ProductName}</span>: <span class="hljs-subst">{UnitsInStock}</span> szt."</span>;
    }
}
</div></code></pre>
<ul>
<li>Supplier.cs</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Supplier</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> SupplierID { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> CompanyName { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Street { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> City { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> ICollection&lt;Product&gt; Products { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-keyword">new</span> List&lt;Product&gt;();
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">string</span> <span class="hljs-title">ToString</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">return</span> CompanyName;
    }
}
</div></code></pre>
<ul>
<li>Program.cs (fragment starego kodu)</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"></span>)</span>
    {
        ...
            product.supplier = supplier;
        ...
    }
</div></code></pre>
<ul>
<li>Program.cs (fragment nowego kodu)</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"></span>)</span>
    {   
        ...

        <span class="hljs-keyword">do</span> {
                Console.WriteLine(<span class="hljs-string">"Dodać nowy produkt? (Tak/Nie)"</span>);
                choice = Console.ReadLine();
                correctAnswer = <span class="hljs-literal">false</span>;
                <span class="hljs-keyword">switch</span> (choice)
                {
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"Tak"</span>:
                        product = createNewProduct();
                        productContext.Products.Add(product);
                        correctAnswer = <span class="hljs-literal">true</span>;
                        <span class="hljs-keyword">break</span>;
                    <span class="hljs-keyword">case</span> <span class="hljs-string">"Nie"</span>:
                        correctAnswer = <span class="hljs-literal">true</span>;
                        <span class="hljs-keyword">break</span>;
                }
                Console.WriteLine(<span class="hljs-string">""</span>);
        } <span class="hljs-keyword">while</span> (!correctAnswer || choice == <span class="hljs-string">"Tak"</span>);

        ...

            supplier.Products.Add(product);

        ...
    }
</div></code></pre>
<hr>
<h1 id="zadanie-c---dwustronna-relacja-supplier------product">Zadanie c - dwustronna relacja Supplier &lt;----&gt; Product</h1>
<ul>
<li>Do klasy &quot;Product&quot; został dodany atrybut, określający Dostawcę danego produktu (tak jak w zad. 2).</li>
<li>Klasa &quot;Supplier&quot; pozostała bez zmian względem implementacji poprzedniego zadania.</li>
<li>W kodzie jedyną zmianą było dodanie ustawienia dostawcy do produktu. Niżej będzie podany fragment kodu, który uległ zmianie.</li>
<li>Klasa ProdContext pozostała bez zmian.</li>
</ul>
<p>Schemat zmienionej bazy danych, wygenerowany przez DataGrip:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/2.png" alt=""></p>
<p>Jak widać, pomimo utworzenia dwukierunkowej relacji, schemat bazy danych nadal się nie zmienił. Z tego wynika, że Entity Framework dokonuje optymalizacji, pozostawiając tylko niezbędną relację w bazie danych, natomiast pozwala na utworzenie dwukierunkowej relacji (można również stworzyć ją w przeciwnym kierunku), aby mieć możliwość łatwiejszego manipulowania powiązanymi między sobą obiektami. W taki sposób Entity Framework unika powielania danych w tabeli Suppliers.</p>
<p>Testowanie dodania nowych produktów i ustawienia ich dostawcy na nowo stworzonego. Tabela Products przed wywołaniem metody dodającej:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/10.png" alt=""></p>
<p>Wynik działania programu w postaci konsolowych komunikatów:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/11.png" alt=""></p>
<p>Sprawdżmy trwałość zmian za pomocą DataGrip. Tabela Product po dodaniu produktów:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/12.png" alt=""></p>
<p>Sprawdżmy trwałość zmian za pomocą DataGrip. Tabela Product po wprowadzeniu zmiany dostawcy:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/13.png" alt=""></p>
<p>Kod:</p>
<ul>
<li>Product.cs</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">using</span> System.Runtime.Intrinsics.X86;

<span class="hljs-keyword">using</span> System.Runtime.Intrinsics.X86;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Product</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> ProductID { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> String? ProductName { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> UnitsInStock { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> Supplier? supplier { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = <span class="hljs-literal">null</span>;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">string</span> <span class="hljs-title">ToString</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">string</span> supName = <span class="hljs-string">"undefined"</span>;
        <span class="hljs-keyword">if</span> (supplier != <span class="hljs-literal">null</span>)
        {
            supName = supplier.CompanyName;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">$"<span class="hljs-subst">{ProductName}</span>: <span class="hljs-subst">{UnitsInStock}</span> szt. Dostawca: <span class="hljs-subst">{supName}</span>"</span>;
    }
}
</div></code></pre>
<ul>
<li>Program.cs (fragment starego kodu)</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"></span>)</span>
    {   
        ...

            supplier.Products.Add(product);

        ...
    }
</div></code></pre>
<ul>
<li>Program.cs (fragment nowego kodu)</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"></span>)</span>
    {
        ...
            supplier.Products.Add(product);
            product.supplier = supplier;
        ...
    }
</div></code></pre>
<hr>
<h1 id="zadanie-d---modelowanie-relacji-wiele-do-wielu">Zadanie d - modelowanie relacji wiele-do-wielu</h1>
<ul>
<li>Została usunięta klasa &quot;Supplier&quot;, skoro nie jest potrzebna w ramach danego zadania.</li>
<li>Pojawiła się klasa &quot;Invoice&quot; odpowiednio do treści zadania, w której mieści się kolekcja pozycji &quot;InvoiceItem&quot; sprzedanych w ramach danej transakcji.</li>
<li>Dodaliśmy pomocniczą klasę &quot;InvoiceItem&quot;, która reprezentuje pojedynczą pozycję transakcji: numer produktu oraz ilość zakupionych produktów o tym numerze w ramach danej transakcji. Ma ona również navigation properties do klasy &quot;Product&quot; oraz &quot;Invoice&quot;.</li>
<li>W klasie &quot;Product&quot; została dodana dodatkowa metoda wypisywania oraz navigation properties do klasy &quot;InvoiceItem&quot;.</li>
<li>Klasę ProdContext rozszerzyliśmy o zbiory &quot;Invoice&quot; oraz &quot;InvoiceItem&quot;, jednocześnie usunęliśmy zbiór &quot;Suppliers&quot;. Oprócz tego, wyznaczyliśmy Composite PrimaryKey.</li>
<li>Kod głównego programu został dopasowany do funkcjonalności, potrzebnych w tym zadaniu. Pojawiła się możliwość wybory wśród 10 opcji akcji:</li>
</ul>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/61.png" alt=""></p>
<p>Schemat zmienionej bazy danych, wygenerowany przez DataGrip:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/60.png" alt=""></p>
<ul>
<li>Stwórmy kilka produktów</li>
</ul>
<p>Tabela Products przed wywołaniem metody dodającej:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/62.png" alt=""></p>
<p>Wynik działania programu w postaci konsolowych komunikatów:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/63.png" alt=""></p>
<p>Sprawdżmy trwałość zmian za pomocą DataGrip. Tabela Product po dodaniu produktów:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/64.png" alt=""></p>
<ul>
<li>Następnie dodamy produkty do koszyka i kupimy je w kilku transakcjach</li>
</ul>
<p>Wynik działania programu w postaci konsolowych komunikatów (pierwsza transakcja):</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/65.png" alt=""></p>
<p>Wynik działania programu w postaci konsolowych komunikatów (druga transakcja):</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/66.png" alt=""></p>
<p>Wynik działania programu w postaci konsolowych komunikatów (trzecia transakcja):</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/67.png" alt=""></p>
<p>Przekonymy się w tym, że liczba produktów w sklepie została zmniejszona za pomocą DataGrip. Tabela Product po zakupieniu produktów:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/68.png" alt=""></p>
<p>Tabela Invoice po przeprowadzeniu 3 transakcji:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/69.png" alt=""></p>
<p>Tabela InvoiceItems po przeprowadzeniu 3 transakcji:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/70.png" alt=""></p>
<ul>
<li>Produkty, które zostały sprzedane w ramach wybranej transakcji:</li>
</ul>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/71.png" alt=""></p>
<ul>
<li>Faktury, w ramach których sprzedany został produkt</li>
</ul>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/72.png" alt=""></p>
<p>Kod:</p>
<ul>
<li>Product.cs</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">using</span> System.Runtime.Intrinsics.X86;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Product</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> ProductID { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> String? ProductName { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> UnitsInStock { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-comment">// Navigation properties</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> ICollection&lt;InvoiceItem&gt; InvoiceItems { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">string</span> <span class="hljs-title">ToString</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">return</span> <span class="hljs-string">$"Product #<span class="hljs-subst">{ProductID}</span> <span class="hljs-subst">{ProductName}</span>"</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">printProductInStock</span>(<span class="hljs-params"></span>)</span>
    {
        Console.WriteLine(<span class="hljs-string">$"Product #<span class="hljs-subst">{ProductID}</span> <span class="hljs-subst">{ProductName}</span>: <span class="hljs-subst">{UnitsInStock}</span> szt."</span>);
    }
}
</div></code></pre>
<ul>
<li>ProdContext.cs</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">using</span> Microsoft.EntityFrameworkCore;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ProdContext</span> : <span class="hljs-title">DbContext</span>
{
    <span class="hljs-keyword">public</span> DbSet&lt;Product&gt; Products { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> DbSet&lt;Invoice&gt; Invoices { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> DbSet&lt;InvoiceItem&gt; InvoiceItems { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnConfiguring</span>(<span class="hljs-params">DbContextOptionsBuilder optionsBuilder</span>)</span>
    {
        <span class="hljs-keyword">base</span>.OnConfiguring(optionsBuilder);
        optionsBuilder.UseSqlite(<span class="hljs-string">"Datasource=MyProductDatabase"</span>);
    }

    <span class="hljs-comment">// Set composite primary key for InvoiceItems</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnModelCreating</span>(<span class="hljs-params">ModelBuilder modelBuilder</span>)</span>
    {
        modelBuilder.Entity&lt;InvoiceItem&gt;()
        .HasKey(x =&gt; <span class="hljs-keyword">new</span> { x.InvoiceNumber, x.ProductID });
    }

}
</div></code></pre>
<ul>
<li>Invoice.cs</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">using</span> System.ComponentModel.DataAnnotations;
<span class="hljs-keyword">using</span> System.Text;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Invoice</span>
{
    <span class="hljs-comment">// Primary key</span>
    [<span class="hljs-meta">Key</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> InvoiceNumber { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> ICollection&lt;InvoiceItem&gt; InvoiceItems { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">string</span> <span class="hljs-title">ToString</span>(<span class="hljs-params"></span>)</span>
    {
        StringBuilder sb = <span class="hljs-keyword">new</span>(<span class="hljs-string">$"Invoice <span class="hljs-subst">{InvoiceNumber}</span>:"</span>);
        <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">foreach</span> (InvoiceItem item <span class="hljs-keyword">in</span> InvoiceItems)
        {
            i++;
            sb.Append(<span class="hljs-string">$"\n\t<span class="hljs-subst">{i}</span>) <span class="hljs-subst">{item}</span>"</span>);
        }
        <span class="hljs-keyword">return</span> sb.ToString();
    }
}
</div></code></pre>
<ul>
<li>InvoiceItem.cs (klasa pomocnicza)</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">using</span> System.ComponentModel.DataAnnotations;
<span class="hljs-keyword">using</span> System.ComponentModel.DataAnnotations.Schema;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">InvoiceItem</span>
{
    <span class="hljs-comment">// Composite primary key</span>
    [<span class="hljs-meta">Key, Column(Order = 0)</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> InvoiceNumber { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    [<span class="hljs-meta">Key, Column(Order = 1)</span>]
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> ProductID { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Quantity { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-comment">// Navigation properties</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> Invoice Invoice { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">virtual</span> Product Product { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">string</span> <span class="hljs-title">ToString</span>(<span class="hljs-params"></span>)</span>

    {
        <span class="hljs-keyword">return</span> <span class="hljs-string">$"<span class="hljs-subst">{Product}</span>: <span class="hljs-subst">{Quantity}</span> szt."</span>;
    }
}
</div></code></pre>
<ul>
<li>Program.cs</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Data.Common;
<span class="hljs-keyword">using</span> System.Linq;
<span class="hljs-keyword">using</span> System.Runtime.CompilerServices;
<span class="hljs-keyword">using</span> Microsoft.EntityFrameworkCore.Diagnostics;
<span class="hljs-keyword">using</span> Microsoft.EntityFrameworkCore;

<span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">createNewProduct</span>(<span class="hljs-params">ProdContext productContext</span>)</span>
    {
        Console.Write(<span class="hljs-string">"Podaj nazwę nowego produktu: "</span>);
        <span class="hljs-keyword">string</span> prodName = Console.ReadLine();
        Console.Write(<span class="hljs-string">"Podaj ilość jednostek danego produktu dostępnych w sklepie: "</span>);
        <span class="hljs-keyword">int</span> quantity = Int32.Parse(Console.ReadLine());

        Product product = <span class="hljs-keyword">new</span> Product { ProductName = prodName, UnitsInStock = quantity };
        Console.Write(<span class="hljs-string">$"Został utworzony produkt: <span class="hljs-subst">{product.ProductName}</span>"</span>);


        productContext.Products.Add(product);
        productContext.SaveChanges();
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addProductToBasket</span>(<span class="hljs-params">ProdContext productContext, List&lt;InvoiceItem&gt; basketItems</span>)</span>
    {
        <span class="hljs-keyword">int</span> prodID, prodQuantity;
        <span class="hljs-keyword">bool</span> correctQuantity = <span class="hljs-literal">false</span>;
        showAvailableProducts(productContext);
        <span class="hljs-keyword">do</span>
        {
            Console.Write(<span class="hljs-string">"\nPodaj ID produktu, który należy dodać do koszyka: "</span>);
            prodID = Int32.Parse(Console.ReadLine());
            Console.WriteLine();
        } <span class="hljs-keyword">while</span> (!productAvailable(productContext, prodID));


        <span class="hljs-keyword">do</span>
        {
            Console.WriteLine();
            Console.Write(<span class="hljs-string">"Podaj ilość sztuk produktu: "</span>);
            prodQuantity = Int32.Parse(Console.ReadLine());

            <span class="hljs-keyword">var</span> query = <span class="hljs-keyword">from</span> product <span class="hljs-keyword">in</span> productContext.Products
                        <span class="hljs-keyword">where</span> product.ProductID == prodID &amp;&amp; product.UnitsInStock &gt;= prodQuantity
                        <span class="hljs-keyword">select</span> product;
            <span class="hljs-keyword">if</span> ((query?.Count() &gt; <span class="hljs-number">0</span>))
            {
                correctQuantity = <span class="hljs-literal">true</span>;
            }
            <span class="hljs-keyword">else</span>
            {
                Console.WriteLine(<span class="hljs-string">"W sklepie nie ma takiej ilości produktów"</span>);
            }
        } <span class="hljs-keyword">while</span> (!correctQuantity);
        InvoiceItem item = <span class="hljs-keyword">new</span> InvoiceItem { ProductID = prodID, Quantity = prodQuantity };
        basketItems.Add(item);
        Console.Write(<span class="hljs-string">$"Do koszyka został dodany produkt o numerze <span class="hljs-subst">{prodID}</span>"</span>);
        productContext.SaveChanges();
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">removeProductFromBasket</span>(<span class="hljs-params">ProdContext productContext, List&lt;InvoiceItem&gt; basketItems</span>)</span>
    {
        <span class="hljs-keyword">int</span> prodID;
        showProductsInBasket(productContext, basketItems);
        <span class="hljs-keyword">do</span>
        {
            Console.Write(<span class="hljs-string">"\nPodaj ID produktu, który należy usunąć z koszyka: "</span>);
            prodID = Int32.Parse(Console.ReadLine());
            Console.WriteLine();
        } <span class="hljs-keyword">while</span> (!productExists(productContext, prodID));

        InvoiceItem item_to_remove = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">foreach</span> (InvoiceItem item <span class="hljs-keyword">in</span> basketItems)
        {
            <span class="hljs-keyword">if</span> (item.ProductID == prodID) item_to_remove = item;
        }
        <span class="hljs-keyword">if</span> (item_to_remove != <span class="hljs-literal">null</span>)
        {
            basketItems.Remove(item_to_remove);
            Console.Write(<span class="hljs-string">$"Z koszyka został usunięty produkt o numerze <span class="hljs-subst">{prodID}</span>"</span>);
        }
        <span class="hljs-keyword">else</span> { Console.Write(<span class="hljs-string">$"W koszyka nie znaleziono produktu o numerze <span class="hljs-subst">{prodID}</span>"</span>); }

    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">buyProductsInBasket</span>(<span class="hljs-params">ProdContext prodContext, List&lt;InvoiceItem&gt; basketItems</span>)</span>
    {
        Invoice invoice = CreateInvoice(basketItems);
        prodContext.Invoices.Add(invoice);
        <span class="hljs-keyword">foreach</span> (InvoiceItem item <span class="hljs-keyword">in</span> basketItems)
        {
            <span class="hljs-keyword">var</span> product = prodContext.Products.FirstOrDefault(prod =&gt; prod.ProductID == item.ProductID);
            product.UnitsInStock -= item.Quantity;
        }
        prodContext.SaveChanges();
        Console.WriteLine(<span class="hljs-string">"Produkty w kosyzku zostały kupione"</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">productAvailable</span>(<span class="hljs-params">ProdContext productContext, <span class="hljs-keyword">int</span> UserProductID</span>)</span>
    {
        <span class="hljs-keyword">var</span> query = <span class="hljs-keyword">from</span> product <span class="hljs-keyword">in</span> productContext.Products
                    <span class="hljs-keyword">where</span> product.ProductID == UserProductID &amp;&amp; product.UnitsInStock &gt; <span class="hljs-number">0</span>
                    <span class="hljs-keyword">select</span> product;
        <span class="hljs-keyword">return</span> (query?.Count() &gt; <span class="hljs-number">0</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">productExists</span>(<span class="hljs-params">ProdContext productContext, <span class="hljs-keyword">int</span> UserProductID</span>)</span>
    {
        <span class="hljs-keyword">var</span> query = <span class="hljs-keyword">from</span> product <span class="hljs-keyword">in</span> productContext.Products
                    <span class="hljs-keyword">where</span> product.ProductID == UserProductID
                    <span class="hljs-keyword">select</span> product;
        <span class="hljs-keyword">return</span> (query?.Count() &gt; <span class="hljs-number">0</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">showAllProducts</span>(<span class="hljs-params">ProdContext prodContext</span>)</span>
    {
        <span class="hljs-keyword">var</span> query = <span class="hljs-keyword">from</span> product <span class="hljs-keyword">in</span> prodContext.Products
                    <span class="hljs-keyword">select</span> product;
        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> product <span class="hljs-keyword">in</span> query)
        {
            product.printProductInStock();
        }
        <span class="hljs-keyword">if</span> (query.Count() == <span class="hljs-number">0</span>)
        {
            Console.WriteLine(<span class="hljs-string">"Nie znaleziono produktów w bazie danych"</span>);
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">showAvailableProducts</span>(<span class="hljs-params">ProdContext prodContext</span>)</span>
    {
        <span class="hljs-keyword">var</span> query = <span class="hljs-keyword">from</span> product <span class="hljs-keyword">in</span> prodContext.Products
                    <span class="hljs-keyword">where</span> product.UnitsInStock &gt; <span class="hljs-number">0</span>
                    <span class="hljs-keyword">select</span> product;
        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> product <span class="hljs-keyword">in</span> query)
        {
            product.printProductInStock();
        }
        <span class="hljs-keyword">if</span> (query?.Count() == <span class="hljs-number">0</span>)
        {
            Console.WriteLine(<span class="hljs-string">"Nie znaleziono dostępnych do zakupu produktów w bazie danych"</span>);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">showProductsInBasket</span>(<span class="hljs-params">ProdContext prodContext, List&lt;InvoiceItem&gt; basketItems</span>)</span>
    {
        <span class="hljs-keyword">foreach</span> (InvoiceItem item <span class="hljs-keyword">in</span> basketItems)
        {
            <span class="hljs-keyword">var</span> product = prodContext.Products
                                  .Include(ii =&gt; ii.InvoiceItems)
                                  .FirstOrDefault(ii =&gt; ii.ProductID == item.ProductID);

            Console.WriteLine(<span class="hljs-string">$"<span class="hljs-subst">{product}</span>: <span class="hljs-subst">{item.Quantity}</span> szt."</span>);
        }
        <span class="hljs-keyword">if</span> (basketItems.Count() == <span class="hljs-number">0</span>)
        {
            Console.WriteLine(<span class="hljs-string">"Nie znaleziono produktów w koszyku"</span>);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Invoice <span class="hljs-title">CreateInvoice</span>(<span class="hljs-params">List&lt;InvoiceItem&gt; items</span>)</span>
    {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Invoice
        {
            InvoiceItems = items
        };
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">showSoldInTransaction</span>(<span class="hljs-params">ProdContext productContext</span>)</span>
    {
        <span class="hljs-keyword">int</span> invoiceNumber;

        Console.Write(<span class="hljs-string">"Podaj ID transakcji do wypisywania zakupionych pozycji: "</span>);
        invoiceNumber = Int32.Parse(Console.ReadLine());
        Console.WriteLine();

        <span class="hljs-keyword">var</span> invoice = productContext.Invoices
                              .Include(inv =&gt; inv.InvoiceItems)
                              .ThenInclude(item =&gt; item.Product)
                              .FirstOrDefault(inv =&gt; inv.InvoiceNumber == invoiceNumber);
        <span class="hljs-keyword">if</span> (invoice != <span class="hljs-literal">null</span>)
        {
            Console.WriteLine(invoice);
        }
        <span class="hljs-keyword">else</span>
        {
            Console.WriteLine(<span class="hljs-string">"Nie znaleziono transakcji o takim ID"</span>);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">showInvoicesIncludeProduct</span>(<span class="hljs-params">ProdContext productContext</span>)</span>
    {
        <span class="hljs-keyword">int</span> prodID;
        showAllProducts(productContext);
        <span class="hljs-keyword">do</span>
        {
            Console.Write(<span class="hljs-string">"Podaj ID produktu, dla którego należy wyszukać transakcji: "</span>);
            prodID = Int32.Parse(Console.ReadLine());
            Console.WriteLine();
        } <span class="hljs-keyword">while</span> (!productExists(productContext, prodID));

        <span class="hljs-keyword">var</span> query = <span class="hljs-keyword">from</span> item <span class="hljs-keyword">in</span> productContext.InvoiceItems.Include(ii =&gt; ii.Invoice)
                    <span class="hljs-keyword">where</span> item.ProductID == prodID
                    <span class="hljs-keyword">select</span> item;

        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> item <span class="hljs-keyword">in</span> query)
        {
            Console.WriteLine(<span class="hljs-string">"Invoice #{0}"</span>, item.InvoiceNumber);
        }
        <span class="hljs-keyword">if</span> (query?.Count() == <span class="hljs-number">0</span>)
        {
            Console.WriteLine(<span class="hljs-string">"Nie znaleziono transakcji, w których by występował dany produkt"</span>);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">showOptions</span>(<span class="hljs-params"></span>)</span>
    {
        Console.WriteLine(<span class="hljs-string">"1. Add new product"</span>);
        Console.WriteLine(<span class="hljs-string">"2. Show all products"</span>);
        Console.WriteLine(<span class="hljs-string">"3. Show available products"</span>);
        Console.WriteLine(<span class="hljs-string">"4. Add product to basket"</span>);
        Console.WriteLine(<span class="hljs-string">"5. Remove product from basket"</span>);
        Console.WriteLine(<span class="hljs-string">"6. Show products in basket"</span>);
        Console.WriteLine(<span class="hljs-string">"7. Buy products in basket"</span>);
        Console.WriteLine(<span class="hljs-string">"8. Show products sold in transaction"</span>);
        Console.WriteLine(<span class="hljs-string">"9. Show invoices having sold the product"</span>);
        Console.WriteLine(<span class="hljs-string">"10. EXIT"</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getUserChoice</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">int</span> choice = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">string</span> input;
        <span class="hljs-keyword">do</span>
        {
            Console.WriteLine();
            showOptions();
            Console.WriteLine(<span class="hljs-string">"\nPodaj jedną liczbę z zakresu 1-10"</span>);
            input = Console.ReadLine();
            <span class="hljs-keyword">int</span>.TryParse(input, <span class="hljs-keyword">out</span> choice);
        } <span class="hljs-keyword">while</span> (choice &lt; <span class="hljs-number">0</span> || choice &gt; <span class="hljs-number">10</span>);
        Console.WriteLine();
        <span class="hljs-keyword">return</span> choice;
    }

    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"></span>)</span>
    {
        ProdContext productContext = <span class="hljs-keyword">new</span> ProdContext();
        List&lt;InvoiceItem&gt; basketItems = <span class="hljs-keyword">new</span> List&lt;InvoiceItem&gt;();

        <span class="hljs-keyword">bool</span> exited = <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">while</span> (!exited)
        {
            <span class="hljs-keyword">switch</span> (getUserChoice())
            {
                <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>: <span class="hljs-comment">// Add new product</span>
                    createNewProduct(productContext);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>: <span class="hljs-comment">// Show all products</span>
                    showAllProducts(productContext);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>: <span class="hljs-comment">// Show available products</span>
                    showAvailableProducts(productContext);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>: <span class="hljs-comment">// Add product to basket</span>
                    addProductToBasket(productContext, basketItems);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>: <span class="hljs-comment">// Remove product from basket</span>
                    removeProductFromBasket(productContext, basketItems);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>: <span class="hljs-comment">// Show products in basket</span>
                    showProductsInBasket(productContext, basketItems);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>: <span class="hljs-comment">// Buy products in basket</span>
                    buyProductsInBasket(productContext, basketItems);
                    basketItems = <span class="hljs-keyword">new</span> List&lt;InvoiceItem&gt;();
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-number">8</span>: <span class="hljs-comment">// Show products sold in transaction</span>
                    showSoldInTransaction(productContext);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-number">9</span>: <span class="hljs-comment">// Show invoices having sold the product</span>
                    showInvoicesIncludeProduct(productContext);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-number">10</span>: <span class="hljs-comment">// EXIT</span>
                    exited = <span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">break</span>;
            }
        }
    }
}
</div></code></pre>
<hr>
<h1 id="zadanie-e---table-per-hierarchy">Zadanie e - Table-Per-Hierarchy:</h1>
<p>Zgodnie ze strategią Table-Per-Hierarchy, tworzymy jedną tabelę Company, która przechowuje wszystkie typy klas
Company.cs:</p>
<pre class="hljs"><code><div><span class="hljs-keyword">namespace</span> <span class="hljs-title">zad5</span>;

<span class="hljs-keyword">internal</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Company</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> CompanyID { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> CompanyName { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = String.Empty;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Street { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = String.Empty;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> City { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = String.Empty;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> ZipCode { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = String.Empty;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">string</span> <span class="hljs-title">ToString</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">return</span> <span class="hljs-string">$"[<span class="hljs-subst">{CompanyID}</span>] <span class="hljs-subst">{CompanyName}</span>"</span>;
    }
}
</div></code></pre>
<p>Supplier.cs:</p>
<pre class="hljs"><code><div><span class="hljs-keyword">namespace</span> <span class="hljs-title">zad5</span>;

<span class="hljs-keyword">internal</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Supplier</span> : <span class="hljs-title">Company</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> SupplierID { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> BankAccountNumber { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = String.Empty;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">string</span> <span class="hljs-title">ToString</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">return</span> <span class="hljs-string">$"<span class="hljs-subst">{<span class="hljs-keyword">base</span>.ToString()}</span> (dostawca)"</span>;
    }
}
</div></code></pre>
<p>Customer.cs:</p>
<pre class="hljs"><code><div><span class="hljs-keyword">namespace</span> <span class="hljs-title">zad5</span>;

<span class="hljs-keyword">internal</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Customer</span> : <span class="hljs-title">Company</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> CustomerID { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Discount { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } <span class="hljs-comment">// In %</span>

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">string</span> <span class="hljs-title">ToString</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">return</span> <span class="hljs-string">$"<span class="hljs-subst">{<span class="hljs-keyword">base</span>.ToString()}</span> (klient)"</span>;
    }
}
</div></code></pre>
<p>CompanyContext.cs</p>
<pre class="hljs"><code><div><span class="hljs-keyword">using</span> Microsoft.EntityFrameworkCore;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">zad5</span>;

<span class="hljs-keyword">internal</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CompanyContext</span> : <span class="hljs-title">DbContext</span>
{
    <span class="hljs-keyword">public</span> DbSet&lt;Company&gt;? Companies { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> DbSet&lt;Supplier&gt;? Suppliers { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> DbSet&lt;Customer&gt;? Customers { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnConfiguring</span>(<span class="hljs-params">DbContextOptionsBuilder optionsBuilder</span>)</span>
    {
        <span class="hljs-keyword">base</span>.OnConfiguring(optionsBuilder);
        optionsBuilder.UseSqlite(<span class="hljs-string">"Datasource=CompaniesDatabase.db"</span>);
    }
}
</div></code></pre>
<p>CreateCompany()</p>
<pre class="hljs"><code><div><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Company? CreateCompany()
    {
        <span class="hljs-keyword">var</span> companyType = <span class="hljs-string">""</span>;
        <span class="hljs-keyword">do</span>
        {
            Console.Write(<span class="hljs-string">"Podaj typ nowej firmy (Supplier/Customer): "</span>);
            companyType = Console.ReadLine();
        }
        <span class="hljs-keyword">while</span> (companyType?.Trim().ToLower() != <span class="hljs-string">"supplier"</span> &amp;&amp; companyType?.Trim().ToLower() != <span class="hljs-string">"customer"</span>);

        Console.Write(<span class="hljs-string">"Podaj nazwę nowej firmy: "</span>);
        <span class="hljs-keyword">var</span> companyName = Console.ReadLine();

        Console.Write(<span class="hljs-string">"Podaj ulicę nowej firmy: "</span>);
        <span class="hljs-keyword">var</span> companyStreet = Console.ReadLine();

        Console.Write(<span class="hljs-string">"Podaj miasto nowej firmy: "</span>);
        <span class="hljs-keyword">var</span> companyCity = Console.ReadLine();

        Console.Write(<span class="hljs-string">"Podaj kod pocztowy nowej firmy: "</span>);
        <span class="hljs-keyword">var</span> companyZipCode = Console.ReadLine();

        <span class="hljs-keyword">switch</span> (companyType?.Trim().ToLower())
        {
            <span class="hljs-keyword">case</span> <span class="hljs-string">"supplier"</span>:
                Console.Write(<span class="hljs-string">"Podaj numer konta bankowego nowej firmy: "</span>);
                String? companyBankAccountNumber = Console.ReadLine();
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Supplier
                {
                    CompanyName = companyName,
                    City = companyCity,
                    Street = companyStreet,
                    ZipCode = companyZipCode,
                    BankAccountNumber = companyBankAccountNumber
                };

            <span class="hljs-keyword">case</span> <span class="hljs-string">"customer"</span>:
                Console.Write(<span class="hljs-string">"Podaj zniżkę nowej firmy: "</span>);
                <span class="hljs-keyword">int</span> companyDiscount = <span class="hljs-keyword">int</span>.Parse(Console.ReadLine());
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Customer
                {
                    CompanyName = companyName,
                    City = companyCity,
                    Street = companyStreet,
                    ZipCode = companyZipCode,
                    Discount = companyDiscount,
                };
            <span class="hljs-keyword">default</span>:
                Console.WriteLine(<span class="hljs-string">"Nie podano typu firmy!"</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
    }
</div></code></pre>
<p>FindCompany()</p>
<pre class="hljs"><code><div>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Company? FindCompany(CompanyContext companyContext)
    {
        Console.Write(<span class="hljs-string">"Podaj ID firmy do wyszukiwania: "</span>);
        <span class="hljs-keyword">var</span> companyId = <span class="hljs-keyword">int</span>.Parse(Console.ReadLine());

        <span class="hljs-keyword">var</span> query = <span class="hljs-keyword">from</span> comp <span class="hljs-keyword">in</span> companyContext.Companies
                    <span class="hljs-keyword">where</span> comp.CompanyID == companyId
                    <span class="hljs-keyword">select</span> comp;

        <span class="hljs-keyword">return</span> query.FirstOrDefault();
    }
</div></code></pre>
<p>ShowAllSuppliers()</p>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ShowAllSuppliers</span>(<span class="hljs-params">CompanyContext companyContext</span>)</span>
    {
        Console.WriteLine(<span class="hljs-string">"Lista dostawców: "</span>);
        
        <span class="hljs-keyword">foreach</span> (Supplier customer <span class="hljs-keyword">in</span> companyContext.Suppliers)
        {
            Console.WriteLine(customer);
        }
    }
</div></code></pre>
<p>ShowAllCustomers()</p>
<pre class="hljs"><code><div>   <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ShowAllCustomers</span>(<span class="hljs-params">CompanyContext companyContext</span>)</span>
    {
        Console.WriteLine(<span class="hljs-string">"Lista klientów: "</span>);
        <span class="hljs-keyword">foreach</span> (Customer customer <span class="hljs-keyword">in</span> companyContext.Customers)
        {
            Console.WriteLine(customer);
        }
    }
</div></code></pre>
<p>ShowAllCompanies()</p>
<pre class="hljs"><code><div>     <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ShowAllCompanies</span>(<span class="hljs-params">CompanyContext companyContext</span>)</span>
    {
        Console.WriteLine(<span class="hljs-string">"Lista wszystkich firm: "</span>);
        <span class="hljs-keyword">foreach</span> (Company company <span class="hljs-keyword">in</span> companyContext.Companies)
        {
            Console.WriteLine(company);
        }
    }
</div></code></pre>
<p>RemoveCompany</p>
<pre class="hljs"><code><div>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">RemoveCompany</span>(<span class="hljs-params">CompanyContext companyContext</span>)</span>
    {
        Console.Write(<span class="hljs-string">"Podaj ID firmy do usunięcia: "</span>);
        <span class="hljs-keyword">var</span> companyId = <span class="hljs-keyword">int</span>.Parse(Console.ReadLine());
        <span class="hljs-keyword">var</span> company = companyContext.Companies.FirstOrDefault(comp =&gt; comp.CompanyID == companyId);
    
        <span class="hljs-keyword">if</span> (company == <span class="hljs-literal">null</span>)
        {
            Console.WriteLine(<span class="hljs-string">"Nie znaleziono firmy o podanym ID."</span>);
            <span class="hljs-keyword">return</span>;
        }
    
        companyContext.Companies.Remove(company);
        companyContext.SaveChanges();
        Console.WriteLine(<span class="hljs-string">"Firma została usunięta."</span>);
    }
</div></code></pre>
<p>main programu Program.cs:</p>
<pre class="hljs"><code><div>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">var</span> companyContext = <span class="hljs-keyword">new</span> CompanyContext();
        
        Company? company = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">var</span> correctAnswer = <span class="hljs-literal">false</span>;
        String? choice;
        <span class="hljs-keyword">do</span>
        {
            Console.WriteLine(<span class="hljs-string">"Dodać nową firmę? (Tak/Nie)"</span>);
            choice = Console.ReadLine();
            <span class="hljs-keyword">switch</span> (choice)
            {
                <span class="hljs-keyword">case</span> <span class="hljs-string">"Tak"</span>:
                    company = CreateCompany();
                    <span class="hljs-keyword">if</span> (company == <span class="hljs-literal">null</span>)
                    {
                        <span class="hljs-keyword">return</span>;
                    }

                    companyContext.Companies.Add(company);
                    companyContext.SaveChanges();
                    correctAnswer = <span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"Nie"</span>:
                    correctAnswer = <span class="hljs-literal">true</span>;
                    companyContext.SaveChanges();
                    <span class="hljs-keyword">break</span>;
            }
        } <span class="hljs-keyword">while</span> (!correctAnswer || choice == <span class="hljs-string">"Tak"</span>);

        ShowAllCompanies(companyContext);
        ShowAllSuppliers(companyContext);
        ShowAllCustomers(companyContext);
    }
</div></code></pre>
<p>Po upewnieniu się, że wszystko działa poprawnie, dodajemy przykładowego Suppliera, a następnie Customera</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/img-zad5/supplier.png" alt=""></p>
<p>Widok bazy danych po wykonaniu:</p>
<pre class="hljs"><code><div><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> Customers
</div></code></pre>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/img-zad5/11.png" alt=""></p>
<p>Następnie dodajemy tą samą metodą wiele Supplierów oraz Customerów</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/img-zad5/1.png" alt=""></p>
<p>...</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/img-zad5/2.png" alt=""></p>
<p>Widok bazy danych:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/img-zad5/4.png" alt=""></p>
<p>Przykładowe działanie FindCompany:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/img-zad5/find.png" alt=""></p>
<p>Wynik wyszukiwania wsyzstkich Supplierów:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/img-zad5/select.png" alt=""></p>
<p>Schemat bazy danych składa się tylko z tabeli Companies:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/img-zad5/5.png" alt=""></p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/img-zad5/6.png" alt=""></p>
<p>Jak widać jest to zwykła tabela przechowująca różne typy, rozróżniająca je za
pomocą pola Discriminator.</p>
<hr>
<h1 id="zadanie-f---table-per-type">Zadanie f - Table-Per-Type:</h1>
<p>Implementacja tego zadania wygląda identycznie. Zmianie uległy jedynie dwie klasy: Customer oraz Supplier. Do nich dodalismy taką adnotacje przed nazwą klasy: [Table(&quot;nazwa_klasy&quot;)]</p>
<p>Supplier.cs:</p>
<pre class="hljs"><code><div><span class="hljs-keyword">using</span> System.ComponentModel.DataAnnotations.Schema;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">zad5</span>;

[<span class="hljs-meta">Table(<span class="hljs-meta-string">"Supplier"</span>)</span>] 
<span class="hljs-keyword">internal</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Supplier</span> : <span class="hljs-title">Company</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> SupplierID { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> BankAccountNumber { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } = String.Empty;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">string</span> <span class="hljs-title">ToString</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">return</span> <span class="hljs-string">$"<span class="hljs-subst">{<span class="hljs-keyword">base</span>.ToString()}</span> (dostawca)"</span>;
    }
}
</div></code></pre>
<p>Customer.cs:</p>
<pre class="hljs"><code><div><span class="hljs-keyword">using</span> System.ComponentModel.DataAnnotations.Schema;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">zad5</span>;

[<span class="hljs-meta">Table(<span class="hljs-meta-string">"Customers"</span>)</span>] 
<span class="hljs-keyword">internal</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Customer</span> : <span class="hljs-title">Company</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> CustomerID { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> Discount { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } <span class="hljs-comment">// In %</span>

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">override</span> <span class="hljs-keyword">string</span> <span class="hljs-title">ToString</span>(<span class="hljs-params"></span>)</span>
    {
        <span class="hljs-keyword">return</span> <span class="hljs-string">$"<span class="hljs-subst">{<span class="hljs-keyword">base</span>.ToString()}</span> (klient)"</span>;
    }
}
</div></code></pre>
<p>Następnie możemy wykonać wszystkie opracje tak jak w poprzednim zadaniu:</p>
<p>Dodajemy Suppliera oraz Customera:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/img-zad6/2.png" alt=""></p>
<p>Wynik bazy danych po wykonaniu 'select * from Companies':</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/img-zad6/3.png" alt=""></p>
<p>Wynik bazy danych po wykonaniu 'select * from Customers':
<img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/img-zad6/4.png" alt=""></p>
<p>Wynik bazy danych po wykonaniu 'select * from Supplier':
<img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/img-zad6/5.png" alt=""></p>
<p>Wynik konsolowego wyszukiwania:
<img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/img-zad6/findIN.png" alt=""></p>
<p>Szkielet bazy danycy:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/img-zad6/schemat.png" alt=""></p>
<p>Schemat bazy danych:</p>
<p><img src="file:///d:/AGH/4 semestr/BD/BD/lab3/img/img-zad6/diagram.png" alt=""></p>
<hr>
<h1 id="zadanie-g---podsumowanie">Zadanie g - Podsumowanie:</h1>
<h3 id="opis-strategi-dziedziczenia-table-per-hierarchy">Opis strategi dziedziczenia: Table-Per-Hierarchy:</h3>
<ul>
<li>Tworzona jest jedna duża tabela przechowująca wszystkie wspólne pola klas dziedziczących po niej jak i pola charakterystyczne dla
poszczególnych typów dziedziczących</li>
<li>Jesli dany typ nie ma takiego pola, w tym miejscu wpisywane jest null. Pole discriminator wskazuje na typ klasy dziedziczącej do rozróżnienia obiektów</li>
</ul>
<h4 id="zalety">Zalety:</h4>
<ul>
<li>Zmniejszenie wykonywania operacji join w porównaniu do operacji na tabelach wykorzystujących Table-Per-Type co może
prowadzić do zwiększenia wydajnosci zapytań</li>
</ul>
<h4 id="wady">Wady:</h4>
<ul>
<li>Marnowanie wolnej pamięci na dużą ilosc pustych komórek - null (szczegolnie zawuażalne jesli kilka klas dziedziczy z jednej
głównej klasy)</li>
<li>Zwiększenie liczby komórek o wartości null (charakterystycznych dla typów dziedziczących) prowadzi do tego, że baza danych staje się nieczytelny</li>
</ul>
<h3 id="opis-strategi-dziedziczenia-table-per-type">Opis strategi dziedziczenia: Table-Per-Type:</h3>
<ul>
<li>Tworzone są kilka tabel zarówno dla klas dziedziczących, jak i dla klasy po której dziedziczą te klasy. Każda klasa dziedzicząca
zawiera indywidualne atrybuty, natomiast klasa bazowa zawiera wyłączmoe pola wspólne dla wszystkich klas dziedziczących</li>
<li>Tabele klas dziedziczących są łączone z tabelą klasy, z której dziedziczą, przy pomocy relacji 1 do 1</li>
</ul>
<h4 id="zalety">Zalety:</h4>
<ul>
<li>Nie przechowujemy już pustych pól - null, dzieki czemu wszystkie nasze wartosci stanowią dane, które zostały wstępnie
wprowadzone do bazy</li>
<li>W przypadku wielu klas dziedziczących pozbywając się dużej ilosci nulli zwiekszamy czytelność bazy danych</li>
</ul>
<h4 id="wady">Wady:</h4>
<ul>
<li>Konieczne jest wykonywanie wielu operacji join (joinujemy za każdym razem klasę bazową z klasą dziedziczącą jeśli chcemy wyciągnąć bardziej szczegółowe dane o konkretnym typie klasy)</li>
</ul>

</body>
</html>
